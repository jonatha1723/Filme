<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Double Wit - Login Seguro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            background-color: #020617;
            color: #ffffff;
            font-family: 'Inter', sans-serif;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">

    <!-- Tela de Carregamento (Mostrada enquanto verifica a volta do Google) -->
    <div id="loading-screen" class="fixed inset-0 bg-[#020617] z-50 flex flex-col items-center justify-center">
        <div class="loading-spinner mb-4"></div>
        <p class="text-slate-400 text-sm animate-pulse">Verificando segurança...</p>
    </div>

    <!-- Container de Login -->
    <div id="auth-card" class="hidden w-full max-w-md glass-card p-10 rounded-[2.5rem] text-center shadow-2xl">
        <div class="mb-8">
            <div class="w-20 h-20 bg-blue-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4 border border-blue-500/20">
                <i class="fas fa-user-shield text-3xl text-blue-500"></i>
            </div>
            <h1 class="text-3xl font-black tracking-tighter italic">DOUBLE WIT</h1>
            <p class="text-slate-400 text-sm mt-2">Acesse sua conta para continuar</p>
        </div>

        <!-- Termos de Privacidade -->
        <div class="mb-8 p-5 bg-white/5 rounded-2xl text-left border border-white/5">
            <label class="flex items-start gap-3 cursor-pointer">
                <input type="checkbox" id="terms-checkbox" class="mt-1 w-5 h-5 rounded border-slate-700 bg-slate-800 text-blue-500 transition-all">
                <span class="text-xs text-slate-300 leading-relaxed">
                    Li e concordo com os Termos de Uso e Política de Privacidade.
                </span>
            </label>
        </div>

        <!-- Botão Google -->
        <button id="btn-login" disabled class="w-full py-4 bg-white text-slate-900 rounded-2xl font-black flex items-center justify-center gap-3 transition-all active:scale-95 shadow-xl disabled:opacity-20 disabled:grayscale">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" class="w-6 h-6">
            ENTRAR COM GOOGLE
        </button>

        <p id="error-msg" class="text-red-500 text-[10px] mt-4 hidden italic text-center"></p>
    </div>

    <!-- Script de Autenticação -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            signInWithRedirect, 
            getRedirectResult, 
            GoogleAuthProvider, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // CONFIGURAÇÃO DOUBLE WIT
        const firebaseConfig = {
            apiKey: "AIzaSyC-DTG7MauMSyvUKDcMxAhLLRAMIyKnYFE",
            authDomain: "double-wit.firebaseapp.com",
            projectId: "double-wit",
            storageBucket: "double-wit.firebasestorage.app",
            messagingSenderId: "2191174521",
            appId: "1:2191174521:web:9268d53b6431fd24cb5da8"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
        
        // URL Final após o login
        const URL_DESTINO = "https://filme-indol-one.vercel.app/";

        const btnLogin = document.getElementById('btn-login');
        const checkbox = document.getElementById('terms-checkbox');
        const loadingScreen = document.getElementById('loading-screen');
        const authCard = document.getElementById('auth-card');
        const errorMsg = document.getElementById('error-msg');

        // 1. Verificar Checkbox
        checkbox.onchange = (e) => {
            btnLogin.disabled = !e.target.checked;
        };

        // 2. Tentar capturar o resultado do redirecionamento (vinda do Chrome)
        getRedirectResult(auth)
            .then((result) => {
                if (result?.user) {
                    // Usuário acabou de voltar do Google logado
                    window.location.replace(URL_DESTINO);
                }
            })
            .catch((error) => {
                console.error("Erro no retorno:", error);
                errorMsg.innerText = "Erro ao processar login. Tente abrir pelo navegador padrão.";
                errorMsg.classList.remove('hidden');
                loadingScreen.classList.add('hidden');
                authCard.classList.remove('hidden');
            });

        // 3. Monitorar Estado de Autenticação
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Se já houver uma sessão ativa, pula direto
                window.location.replace(URL_DESTINO);
            } else {
                // Se não estiver logado, mostra a tela de login
                loadingScreen.classList.add('hidden');
                authCard.classList.remove('hidden');
            }
        });

        // 4. Ação do Botão: Força o Redirecionamento (abre o Chrome externo no Android)
        btnLogin.onclick = () => {
            errorMsg.classList.add('hidden');
            // signInWithRedirect é o método que o Google aceita em aplicativos
            signInWithRedirect(auth, provider);
        };

    </script>
</body>
</html>

